<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sergio Nava">
<meta name="dcterms.date" content="2025-06-16">

<title>Análisis de Datos de Tiempos de Fallo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="R_survival_revisado_files/libs/clipboard/clipboard.min.js"></script>
<script src="R_survival_revisado_files/libs/quarto-html/quarto.js"></script>
<script src="R_survival_revisado_files/libs/quarto-html/popper.min.js"></script>
<script src="R_survival_revisado_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="R_survival_revisado_files/libs/quarto-html/anchor.min.js"></script>
<link href="R_survival_revisado_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="R_survival_revisado_files/libs/quarto-html/quarto-syntax-highlighting-3a01e2046221230fdceeea94b1ec5d67.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="R_survival_revisado_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="R_survival_revisado_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="R_survival_revisado_files/libs/bootstrap/bootstrap-7fae45cde6e28fcc6d39b95ff5a808d4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#introducción" id="toc-introducción" class="nav-link active" data-scroll-target="#introducción">Introducción</a></li>
  <li><a href="#conjuntos-de-datos-del-paquete-survival" id="toc-conjuntos-de-datos-del-paquete-survival" class="nav-link" data-scroll-target="#conjuntos-de-datos-del-paquete-survival">Conjuntos de datos del paquete <code>survival</code></a></li>
  <li><a href="#la-función-surv" id="toc-la-función-surv" class="nav-link" data-scroll-target="#la-función-surv">1. La función <code>Surv</code></a></li>
  <li><a href="#la-función-survfit" id="toc-la-función-survfit" class="nav-link" data-scroll-target="#la-función-survfit">2. La función <code>survfit</code></a></li>
  <li><a href="#la-función-survexp" id="toc-la-función-survexp" class="nav-link" data-scroll-target="#la-función-survexp">3. La función <code>survexp</code></a></li>
  <li><a href="#la-función-survdiff" id="toc-la-función-survdiff" class="nav-link" data-scroll-target="#la-función-survdiff">4. La función <code>survdiff()</code></a></li>
  <li><a href="#la-función-survreg" id="toc-la-función-survreg" class="nav-link" data-scroll-target="#la-función-survreg">5. La función <code>survreg()</code></a></li>
  <li><a href="#la-función-coxph" id="toc-la-función-coxph" class="nav-link" data-scroll-target="#la-función-coxph">6. La función <code>coxph()</code></a></li>
  <li><a href="#la-función-survfit.coxph" id="toc-la-función-survfit.coxph" class="nav-link" data-scroll-target="#la-función-survfit.coxph">7. La función <code>survfit.coxph()</code></a></li>
  <li><a href="#la-función-basehaz" id="toc-la-función-basehaz" class="nav-link" data-scroll-target="#la-función-basehaz">8. La función <code>basehaz()</code></a></li>
  <li><a href="#la-función-residuals.coxph" id="toc-la-función-residuals.coxph" class="nav-link" data-scroll-target="#la-función-residuals.coxph">9. La función <code>residuals.coxph()</code></a></li>
  <li><a href="#la-función-cox.zph" id="toc-la-función-cox.zph" class="nav-link" data-scroll-target="#la-función-cox.zph">10. La función <code>cox.zph()</code></a></li>
  <li><a href="#la-función-strata" id="toc-la-función-strata" class="nav-link" data-scroll-target="#la-función-strata">11. La función <code>strata()</code></a></li>
  <li><a href="#referencias" id="toc-referencias" class="nav-link" data-scroll-target="#referencias">Referencias</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Análisis de Datos de Tiempos de Fallo</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sergio Nava </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 16, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<!-- banner.html -->
<div id="custom-banner" style="background-color: white; color: white; padding: 20px; text-align: center;">
<p><img src="figs/Banner_diplomado.jpg" alt="Banner" style="height: 220px; vertical-align: middle; margin-right: 1px;"></p>
</div>
<!-- custom-header.html -->
<div id="custom-logo" style="position: absolute; top: 10px; left: 10px;">
<p><img src="figs/CIMAT.png" alt="Logo CIMAT" style="height: 120px;"></p>
</div>
<section id="introducción" class="level2">
<h2 class="anchored" data-anchor-id="introducción">Introducción</h2>
<p>En esta página se presentan las principales herramientas computacionales para llevar a cabo un análisis de tiempos de vida utilizando el lenguaje de programación R, en particular mediante el paquete <code>survival</code>. Estas funciones son fundamentales para el estudio de datos censurados y/o truncados, como suele encontrarse en bioestadística, análisis de fiabilidad, y otras áreas donde interesa modelar el tiempo hasta un evento (por ejemplo, muerte, recaída o falla mecánica).</p>
<p>Aquí nos enfocamos en herramientas prácticas para aplicar modelos de supervivencia en datos reales con R. Para un tratamiento teórico más profundo, se recomienda consultar los textos clásicos de <span class="citation" data-cites="klein2003">Klein &amp; Moeschberger (<a href="#ref-klein2003" role="doc-biblioref">2003</a>)</span>, así como <span class="citation" data-cites="therneau2000">Therneau &amp; Grambsch (<a href="#ref-therneau2000" role="doc-biblioref">2000</a>)</span>.</p>
<p>Para comenzar, es necesario cargar la biblioteca <code>survival</code>, que contiene las funciones centrales para el análisis de supervivencia en R. Una exposición clara y aplicada puede encontrarse en <span class="citation" data-cites="moore2016">Moore (<a href="#ref-moore2016" role="doc-biblioref">2016</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El paquete incluye varios conjuntos de datos precargados que pueden utilizarse para ilustrar métodos de análisis de supervivencia, entre ellos:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="at">package =</span> <span class="st">"survival"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="conjuntos-de-datos-del-paquete-survival" class="level2">
<h2 class="anchored" data-anchor-id="conjuntos-de-datos-del-paquete-survival">Conjuntos de datos del paquete <code>survival</code></h2>
<p>A continuación se listan algunos de los datasets incluidos en el paquete <code>survival</code>, ampliamente utilizados para ilustrar técnicas de análisis de supervivencia:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<thead>
<tr class="header">
<th>Nombre del dataset</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>lung</code></td>
<td>Supervivencia en pacientes con cáncer de pulmón</td>
</tr>
<tr class="even">
<td><code>ovarian</code></td>
<td>Ensayo clínico de mantenimiento en pacientes con cáncer de ovario</td>
</tr>
<tr class="odd">
<td><code>aml</code></td>
<td>Datos de pacientes con leucemia mieloide aguda</td>
</tr>
<tr class="even">
<td><code>veteran</code></td>
<td>Ensayo clínico en cáncer de pulmón con dos tratamientos</td>
</tr>
<tr class="odd">
<td><code>jasa</code></td>
<td>Supervivencia de pacientes en lista de espera para trasplante de corazón</td>
</tr>
<tr class="even">
<td><code>heart</code></td>
<td>Datos de entrada/salida de pacientes en el programa de trasplante cardíaco</td>
</tr>
<tr class="odd">
<td><code>pbc</code></td>
<td>Estudio longitudinal sobre colangitis biliar primaria</td>
</tr>
<tr class="even">
<td><code>colon</code></td>
<td>Datos de supervivencia en pacientes con cáncer de colon</td>
</tr>
<tr class="odd">
<td><code>kidney</code></td>
<td>Tiempo hasta el fallo de catéteres renales</td>
</tr>
<tr class="even">
<td><code>cancer</code></td>
<td>Datos de distintos tipos de cáncer (datos ilustrativos)</td>
</tr>
</tbody>
</table>
<p>Puedes cargar cualquiera de estos conjuntos con <code>data(nombre, package = "survival")</code>, por ejemplo:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(lung, <span class="at">package =</span> <span class="st">"survival"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="la-función-surv" class="level2">
<h2 class="anchored" data-anchor-id="la-función-surv">1. La función <code>Surv</code></h2>
<p>Esta función permite crear objetos de tipo supervivencia. Es la base para trabajar con modelos de supervivencia en R.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Surv</span>(time, time2, event, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">'right'</span>, <span class="st">'left'</span>, <span class="st">'interval'</span>, <span class="st">'counting'</span>, <span class="st">'interval2'</span>), <span class="at">origin =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.Surv</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>time</code>: Representa el tiempo de inicio de la observación. Para datos de intervalo, el primer argumento es el extremo inicial del intervalo.</li>
<li><code>time2</code>: Representa el indicador de estado, normalmente 0 = vivo (censurado), 1 = muerto (no censurado). Otras opciones son VERDADERO/FALSO (VERDADERO = la muerte) o 1/2 (2 = muerto). Para datos con censura de intervalo, el indicador de estado es 0 = censura a la derecha, 1 = suceso ocurrido en <code>time</code>, 2 = censura a la izquierda, 3 = censura de intervalo. Este indicador puede ser omitido en el caso de que se asuma que todos los sujetos tienen el mismo estado.</li>
<li><code>event</code>: Representa el tiempo de finalización de la observación para un intervalo censurado o proceso de conteo. Se asume que los intervalos están abiertos a la izquierda y cerrados a la derecha, (el principio, el final]. Para un proceso de recuento de datos <code>event</code> indica si un acontecimiento ocurrió al final del intervalo.</li>
<li><code>origin</code>: Es una utilidad que permite trabajar bajo el enfoque de los procesos de recuento. Esta opción es usada en un modelo que contiene estratos dependientes del tiempo, para enumerar los sujetos correctamente que cambian de un estrato a otro. En raras ocasiones se suele emplear.</li>
<li><code>x</code>: Cualquier objeto de R.</li>
</ul>
<section id="ejemplos" class="level3">
<h3 class="anchored" data-anchor-id="ejemplos">Ejemplos</h3>
<section id="cuando-se-observan-longitudes-de-tiempo" class="level4">
<h4 class="anchored" data-anchor-id="cuando-se-observan-longitudes-de-tiempo">Cuando se observan longitudes de tiempo</h4>
<div class="callout callout-style-default callout-note callout-titled" title="Datos del ejemplo: lung">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Datos del ejemplo: lung
</div>
</div>
<div class="callout-body-container callout-body">
<p>El conjunto de datos <code>lung</code> se refiere al estudio de supervivencia en pacientes con cáncer de pulmón, recopilado por el <em>North Central Cancer Treatment Group</em>.</p>
<p>Contiene <strong>228 registros</strong> y <strong>10 variables</strong>, que son:</p>
<ul>
<li><code>inst</code>: código de la institución médica<br>
</li>
<li><code>time</code>: tiempo de supervivencia o censura (en días)<br>
</li>
<li><code>status</code>: estado del paciente (1 = censurado, 2 = fallecido)<br>
</li>
<li><code>age</code>: edad del paciente (en años)<br>
</li>
<li><code>sex</code>: sexo del paciente (1 = hombre, 2 = mujer)<br>
</li>
<li><code>ph.ecog</code>: puntaje ECOG (estado funcional del paciente)<br>
</li>
<li><code>ph.karno</code>: puntaje Karnofsky según el médico<br>
</li>
<li><code>pat.karno</code>: puntaje Karnofsky según el paciente<br>
</li>
<li><code>meal.cal</code>: calorías ingeridas diariamente<br>
</li>
<li><code>wt.loss</code>: pérdida de peso en los últimos seis meses (en libras)</li>
</ul>
<p>Este conjunto permite analizar cómo variables clínicas y funcionales se asocian con el tiempo de supervivencia en pacientes con cáncer avanzado.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cancer, <span class="at">package=</span><span class="st">"survival"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lung)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  inst time status age sex ph.ecog ph.karno pat.karno meal.cal wt.loss
1    3  306      2  74   1       1       90       100     1175      NA
2    3  455      2  68   1       0       90        90     1225      15
3    3 1010      1  56   1       0       90        90       NA      15
4    5  210      2  57   1       1       90        60     1150      11
5    1  883      2  60   1       0      100        90       NA       0
6   12 1022      1  74   1       1       50        80      513       0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Surv</span>(lung<span class="sc">$</span>time, lung<span class="sc">$</span>status) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]  306   455  1010+  210   883  1022+  310   361   218   166   170   654 
 [13]  728    71   567   144   613   707    61    88   301    81   624   371 
 [25]  394   520   574   118   390    12   473    26   533   107    53   122 
 [37]  814   965+   93   731   460   153   433   145   583    95   303   519 
 [49]  643   765   735   189    53   246   689    65     5   132   687   345 
 [61]  444   223   175    60   163    65   208   821+  428   230   840+  305 
 [73]   11   132   226   426   705   363    11   176   791    95   196+  167 
 [85]  806+  284   641   147   740+  163   655   239    88   245   588+   30 
 [97]  179   310   477   166   559+  450   364   107   177   156   529+   11 
[109]  429   351    15   181   283   201   524    13   212   524   288   363 
[121]  442   199   550    54   558   207    92    60   551+  543+  293   202 
[133]  353   511+  267   511+  371   387   457   337   201   404+  222    62 
[145]  458+  356+  353   163    31   340   229   444+  315+  182   156   329 
[157]  364+  291   179   376+  384+  268   292+  142   413+  266+  194   320 
[169]  181   285   301+  348   197   382+  303+  296+  180   186   145   269+
[181]  300+  284+  350   272+  292+  332+  285   259+  110   286   270    81 
[193]  131   225+  269   225+  243+  279+  276+  135    79    59   240+  202+
[205]  235+  105   224+  239   237+  173+  252+  221+  185+   92+   13   222+
[217]  192+  183   211+  175+  197+  203+  116   188+  191+  105+  174+  177+</code></pre>
</div>
</div>
</section>
<section id="cuando-se-registran-tiempos-de-entrada-y-salida" class="level4">
<h4 class="anchored" data-anchor-id="cuando-se-registran-tiempos-de-entrada-y-salida">Cuando se registran tiempos de entrada y salida</h4>
<p>El segundo conjunto de datos usado como ejemplo en este caso es el conjunto “heart”, contiene información sobre supervivencia de 172 pacientes en la lista de espera del programa de transplantes de corazón del hospital de Standford. El registro se muestra como sigue en la siguiente figura.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(heart)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  start stop event        age      year surgery transplant id
1     0   50     1 -17.155373 0.1232033       0          0  1
2     0    6     1   3.835729 0.2546201       0          0  2
3     0    1     0   6.297057 0.2655715       0          0  3
4     1   16     1   6.297057 0.2655715       0          1  3
5     0   36     0  -7.737166 0.4900753       0          0  4
6    36   39     1  -7.737166 0.4900753       0          1  4</code></pre>
</div>
</div>
<p>En este caso cada individuo se incorpora al estudio en el instante que indica la variable <code>start</code>, y abandona el estudio en el instante indicado por <code>stop</code>. Es decir los pacientes entran en el estudio de manera escalonada, esta es la forma habitual en que los individuos son incorporados en estudios de Supervivencia, a diferencia de en estudios de Fiabilidad, donde todos los sujetos entran en estudio a la vez. No sólo estamos interesados en la longitud del intervalo que determina el tiempo de vida si también de dónde está localizado. La variable <code>event</code> nos dice de cada individuo si está vivo o falleció al final del estudio. Además se incluye otro tipo de información como la edad del individuo (<code>age</code>), si se le ha realizado un transplante o no (<code>transplant</code>) y si ha recibido otro tipo de cirugía antes (<code>surgery</code>). Ahora el resultado de la función <code>Surv</code> es el objeto que se muestra, en parte, a continuación.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(heart,<span class="fu">Surv</span>(start, stop, event))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] (  0.0,  50.0]  (  0.0,   6.0]  (  0.0,   1.0+] (  1.0,  16.0] 
  [5] (  0.0,  36.0+] ( 36.0,  39.0]  (  0.0,  18.0]  (  0.0,   3.0] 
  [9] (  0.0,  51.0+] ( 51.0, 675.0]  (  0.0,  40.0]  (  0.0,  85.0] 
 [13] (  0.0,  12.0+] ( 12.0,  58.0]  (  0.0,  26.0+] ( 26.0, 153.0] 
 [17] (  0.0,   8.0]  (  0.0,  17.0+] ( 17.0,  81.0]  (  0.0,  37.0+]
 [21] ( 37.0,1387.0]  (  0.0,   1.0]  (  0.0,  28.0+] ( 28.0, 308.0] 
 [25] (  0.0,  36.0]  (  0.0,  20.0+] ( 20.0,  43.0]  (  0.0,  37.0] 
 [29] (  0.0,  18.0+] ( 18.0,  28.0]  (  0.0,   8.0+] (  8.0,1032.0] 
 [33] (  0.0,  12.0+] ( 12.0,  51.0]  (  0.0,   3.0+] (  3.0, 733.0] 
 [37] (  0.0,  83.0+] ( 83.0, 219.0]  (  0.0,  25.0+] ( 25.0,1800.0+]
 [41] (  0.0,1401.0+] (  0.0, 263.0]  (  0.0,  71.0+] ( 71.0,  72.0] 
 [45] (  0.0,  35.0]  (  0.0,  16.0+] ( 16.0, 852.0]  (  0.0,  16.0] 
 [49] (  0.0,  17.0+] ( 17.0,  77.0]  (  0.0,  51.0+] ( 51.0,1587.0+]
 [53] (  0.0,  23.0+] ( 23.0,1572.0+] (  0.0,  12.0]  (  0.0,  46.0+]
 [57] ( 46.0, 100.0]  (  0.0,  19.0+] ( 19.0,  66.0]  (  0.0,   4.5+]
 [61] (  4.5,   5.0]  (  0.0,   2.0+] (  2.0,  53.0]  (  0.0,  41.0+]
 [65] ( 41.0,1408.0+] (  0.0,  58.0+] ( 58.0,1322.0+] (  0.0,   3.0] 
 [69] (  0.0,   2.0]  (  0.0,  40.0]  (  0.0,   1.0+] (  1.0,  45.0] 
 [73] (  0.0,   2.0+] (  2.0, 996.0]  (  0.0,  21.0+] ( 21.0,  72.0] 
 [77] (  0.0,   9.0]  (  0.0,  36.0+] ( 36.0,1142.0+] (  0.0,  83.0+]
 [81] ( 83.0, 980.0]  (  0.0,  32.0+] ( 32.0, 285.0]  (  0.0, 102.0] 
 [85] (  0.0,  41.0+] ( 41.0, 188.0]  (  0.0,   3.0]  (  0.0,  10.0+]
 [89] ( 10.0,  61.0]  (  0.0,  67.0+] ( 67.0, 942.0+] (  0.0, 149.0] 
 [93] (  0.0,  21.0+] ( 21.0, 343.0]  (  0.0,  78.0+] ( 78.0, 916.0+]
 [97] (  0.0,   3.0+] (  3.0,  68.0]  (  0.0,   2.0]  (  0.0,  69.0] 
[101] (  0.0,  27.0+] ( 27.0, 842.0+] (  0.0,  33.0+] ( 33.0, 584.0] 
[105] (  0.0,  12.0+] ( 12.0,  78.0]  (  0.0,  32.0]  (  0.0,  57.0+]
[109] ( 57.0, 285.0]  (  0.0,   3.0+] (  3.0,  68.0]  (  0.0,  10.0+]
[113] ( 10.0, 670.0+] (  0.0,   5.0+] (  5.0,  30.0]  (  0.0,  31.0+]
[117] ( 31.0, 620.0+] (  0.0,   4.0+] (  4.0, 596.0+] (  0.0,  27.0+]
[121] ( 27.0,  90.0]  (  0.0,   5.0+] (  5.0,  17.0]  (  0.0,   2.0] 
[125] (  0.0,  46.0+] ( 46.0, 545.0+] (  0.0,  21.0]  (  0.0, 210.0+]
[129] (210.0, 515.0+] (  0.0,  67.0+] ( 67.0,  96.0]  (  0.0,  26.0+]
[133] ( 26.0, 482.0+] (  0.0,   6.0+] (  6.0, 445.0+] (  0.0, 428.0+]
[137] (  0.0,  32.0+] ( 32.0,  80.0]  (  0.0,  37.0+] ( 37.0, 334.0] 
[141] (  0.0,   5.0]  (  0.0,   8.0+] (  8.0, 397.0+] (  0.0,  60.0+]
[145] ( 60.0, 110.0]  (  0.0,  31.0+] ( 31.0, 370.0+] (  0.0, 139.0+]
[149] (139.0, 207.0]  (  0.0, 160.0+] (160.0, 186.0]  (  0.0, 340.0] 
[153] (  0.0, 310.0+] (310.0, 340.0+] (  0.0,  28.0+] ( 28.0, 265.0+]
[157] (  0.0,   4.0+] (  4.0, 165.0]  (  0.0,   2.0+] (  2.0,  16.0] 
[161] (  0.0,  13.0+] ( 13.0, 180.0+] (  0.0,  21.0+] ( 21.0, 131.0+]
[165] (  0.0,  96.0+] ( 96.0, 109.0+] (  0.0,  21.0]  (  0.0,  38.0+]
[169] ( 38.0,  39.0+] (  0.0,  31.0+] (  0.0,  11.0+] (  0.0,   6.0] </code></pre>
</div>
</div>
</section>
</section>
<section id="ejercicio" class="level3">
<h3 class="anchored" data-anchor-id="ejercicio">Ejercicio</h3>
<ul>
<li>Carga el dataset <code>ovarian</code> y construye el objeto <code>Surv(futime, fustat)</code>. ¿Qué tipo de censura presentan los datos?</li>
</ul>
</section>
</section>
<section id="la-función-survfit" class="level2">
<h2 class="anchored" data-anchor-id="la-función-survfit">2. La función <code>survfit</code></h2>
<p>Permite calcular curvas de supervivencia no paramétricas (Kaplan-Meier o Fleming-Harrington) o estimar curvas ajustadas a modelos de Cox.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit</span>(formula, data, <span class="at">type =</span> <span class="st">"kaplan-meier"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p><code>formula</code>: Objeto que define la fórmula del modelo a ajustar.</p></li>
<li><p><code>data</code>: Conjunto de datos que se utiliza para interpretar las variables mencionadas en los argumentos <code>formula</code>, <code>subset</code> y <code>weights</code>.</p></li>
<li><p><code>weights</code>: Pesos aplicados a cada caso u observación.</p></li>
<li><p><code>subset</code>: Expresión que indica un subconjunto de las filas del conjunto de datos que se utilizarán en la estimación. Puede ser:</p>
<ul>
<li>un vector lógico (de longitud igual al número de observaciones),</li>
<li>un vector numérico que indique los índices de observaciones a incluir (o excluir si son negativos),</li>
<li>un vector de caracteres con los nombres de las filas. Por defecto, se incluyen todas las observaciones.</li>
</ul></li>
<li><p><code>na.action</code>: Función utilizada para tratar los valores perdidos (<code>NA</code>). Se aplica al marco del modelo después de aplicar <code>subset</code>. Por defecto es <code>options()$na.action</code>. Un valor común es <code>na.omit</code>, que excluye las observaciones con datos faltantes.</p></li>
<li><p><code>times</code>: Vector de tiempos en los cuales se evalúa la curva de supervivencia. Por defecto, la curva se evalúa en cada valor distinto del vector de tiempos especificado en <code>formula</code>.</p></li>
<li><p><code>type</code>: Cadena de caracteres que especifica el tipo de curva de supervivencia a estimar. Los valores posibles son:</p>
<ul>
<li><code>"kaplan-meier"</code> (por defecto),</li>
<li><code>"fleming-harrington"</code>,</li>
<li><code>"fh2"</code> (cuando se proporciona una fórmula).</li>
</ul></li>
<li><p><code>error</code>: Cadena de caracteres que indica el método para estimar el error estándar. Los valores permitidos son:</p>
<ul>
<li><code>"greenwood"</code>: utiliza la fórmula de Greenwood,</li>
<li><code>"tsiatis"</code>: utiliza la fórmula de Tsiatis. Basta con especificar la primera letra del nombre.</li>
</ul></li>
<li><p><code>conf.type</code>: Tipo de intervalo de confianza. Las opciones son:</p>
<ul>
<li><code>"none"</code>: no se calculan intervalos de confianza,</li>
<li><code>"plain"</code>: intervalo estándar de la forma <code>curve ± k × se(curve)</code>,</li>
<li><code>"log"</code> (por defecto): intervalos basados en <code>log(survival)</code>,</li>
<li><code>"log-log"</code>: intervalos basados en <code>log(-log(survival))</code>.</li>
</ul></li>
<li><p><code>start.time</code>: Valor numérico que indica el instante de tiempo a partir del cual comenzar a calcular la supervivencia. La curva estimada será condicional a haber sobrevivido hasta ese punto.</p></li>
<li><p><code>conf.int</code>: Nivel de confianza para los intervalos calculados. Por defecto, se usa <code>0.95</code> para construir intervalos al 95%.</p></li>
<li><p><code>se.fit</code>: Valor lógico (<code>TRUE</code> o <code>FALSE</code>) que indica si deben calcularse los errores estándar de la estimación. Su valor por defecto es <code>TRUE</code>.</p></li>
</ul>
<section id="resultados" class="level3">
<h3 class="anchored" data-anchor-id="resultados">Resultados</h3>
<ul>
<li><p><code>n</code>: Número total de sujetos incluidos en cada curva de supervivencia.</p></li>
<li><p><code>time</code>: Instantes temporales en los que la curva de supervivencia presenta un salto (es decir, ocurre un evento).</p></li>
<li><p><code>n.risk</code>: Número de sujetos en riesgo justo antes de cada tiempo <code>t</code>.</p></li>
<li><p><code>n.event</code>: Número de eventos (sucesos observados) que ocurren en cada tiempo <code>t</code>.</p></li>
<li><p><code>n.enter</code>: Solo para datos de procesos de recuento. Indica cuántos sujetos entran al conjunto de riesgo en el tiempo <code>t</code>.</p></li>
<li><p><code>n.censor</code>: Solo para procesos de recuento. Representa el número de sujetos que salen del conjunto de riesgo sin haber experimentado el evento, en el tiempo <code>t</code>.</p></li>
<li><p><code>surv</code>: Estimación de la función de supervivencia justo después del tiempo <code>t</code> (es decir, en <code>t+0</code>).</p></li>
<li><p><code>std.err</code>: Error estándar asociado a la estimación de la función de supervivencia o del riesgo acumulado, según el tipo de salida.</p></li>
<li><p><code>upper</code>: Límite superior del intervalo de confianza para la función de supervivencia.</p></li>
<li><p><code>lower</code>: Límite inferior del intervalo de confianza para la función de supervivencia.</p></li>
<li><p><code>strata</code>: Si se estiman múltiples curvas (por ejemplo, por grupos), esta componente indica el número de elementos de <code>time</code>, <code>surv</code>, etc. que corresponden a cada una. Los nombres asociados sirven como etiquetas de las curvas.</p></li>
</ul>
</section>
<section id="ejemplo" class="level3">
<h3 class="anchored" data-anchor-id="ejemplo">Ejemplo</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Datos del ejemplo: aml">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Datos del ejemplo: aml
</div>
</div>
<div class="callout-body-container callout-body">
<p>El conjunto de datos utilizado en este ejemplo, llamado <code>aml</code>, se refiere al análisis de supervivencia en pacientes con leucemia mieloide aguda.</p>
<ul>
<li><code>time</code>: tiempo hasta el evento (supervivencia o censura),</li>
<li><code>status</code>: indicador del estado del evento (1 = evento, 0 = censura),</li>
<li><code>x</code>: grupo de tratamiento (si se mantuvo o no la quimioterapia).</li>
</ul>
<p>Este conjunto de datos permite explorar la siguiente pregunta clínica:<br>
<strong>¿Debería extenderse el tratamiento de quimioterapia a ciclos adicionales para mejorar la supervivencia?</strong></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(aml)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  time status          x
1    9      1 Maintained
2   13      1 Maintained
3   13      0 Maintained
4   18      1 Maintained
5   23      1 Maintained
6   28      0 Maintained</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>leukemia.surv <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> x, <span class="at">data =</span> aml)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(leukemia.surv, <span class="at">lty =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">100</span>,.<span class="dv">9</span>,<span class="fu">c</span>(<span class="st">"Maintenance"</span>,<span class="st">"No Maintenance"</span>),<span class="at">lty=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Kaplan-Meier Curves</span><span class="sc">\n</span><span class="st">for AML Maintenance Study"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_survival_revisado_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>lsurv2<span class="ot">&lt;-</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(time,status)<span class="sc">~</span>x,aml, <span class="at">type=</span><span class="st">'fleming'</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lsurv2,<span class="at">lty=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,<span class="at">fun=</span><span class="st">"cumhaz"</span>,<span class="at">xlab=</span><span class="st">"Months"</span>,<span class="at">ylab=</span><span class="st">"Cumulative Hazard"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_survival_revisado_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Observando la curva de supervivencia que hemos obtenido , vemos como en los 50 primeros meses de tratamiento de la enfermedad con quimioterapia, la supervivencia de estos pacientes aumentaba progresivamente, hasta mantenerse casi estable a partir de ese tiempo.</p>
</section>
</section>
<section id="la-función-survexp" class="level2">
<h2 class="anchored" data-anchor-id="la-función-survexp">3. La función <code>survexp</code></h2>
<p>Devuelve la supervivencia esperada de una cohorte de sujetos, o la supervivencia esperada para cada sujeto de forma individual.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survexp</span>(formula, data, weights, subset, na.action, times, <span class="at">cohort=</span><span class="cn">TRUE</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="at">conditional=</span><span class="cn">FALSE</span>, <span class="at">ratetable=</span>survexp.us, <span class="at">scale=</span><span class="dv">1</span>, npoints,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>se.fit, <span class="at">model=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">FALSE</span>, <span class="at">y=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>Formula</code>. Fórmula o modelo antes descrito.</li>
</ul>
<section id="ejemplo-1" class="level3">
<h3 class="anchored" data-anchor-id="ejemplo-1">Ejemplo</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Datos del ejemplo: pbc">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Datos del ejemplo: pbc
</div>
</div>
<div class="callout-body-container callout-body">
<p>El conjunto de datos <code>pbc</code> (<em>Primary Biliary Cirrhosis</em>) proviene de un estudio clínico de la <em>Mayo Clinic</em> sobre una enfermedad hepática autoinmune crónica. Contiene información clínica y de seguimiento sobre pacientes con esta enfermedad.</p>
<p>Incluye <strong>418 observaciones</strong> y las siguientes variables principales:</p>
<ul>
<li><code>id</code>: identificador del paciente<br>
</li>
<li><code>time</code>: tiempo de seguimiento en días<br>
</li>
<li><code>status</code>: indicador del evento (0 = censurado, 1 = trasplante, 2 = muerte)<br>
</li>
<li><code>trt</code>: grupo de tratamiento (1 = D-penicilamina, 2 = placebo)<br>
</li>
<li><code>age</code>: edad del paciente en años<br>
</li>
<li><code>sex</code>: sexo del paciente (<code>"m"</code> para masculino, <code>"f"</code> para femenino)<br>
</li>
<li><code>ascites</code>: presencia de ascitis (0 = no, 1 = sí)<br>
</li>
<li><code>hepato</code>: presencia de hepatomegalia (0 = no, 1 = sí)<br>
</li>
<li><code>spiders</code>: presencia de arañas vasculares (0 = no, 1 = sí)<br>
</li>
<li><code>edema</code>: grado de edema periférico<br>
</li>
<li><code>bili</code>: nivel de bilirrubina sérica (mg/dL)<br>
</li>
<li><code>chol</code>: nivel de colesterol sérico (mg/dL)<br>
</li>
<li><code>albumin</code>: nivel de albúmina sérica (g/dL)<br>
</li>
<li><code>copper</code>: nivel de cobre sérico (mcg/dL)<br>
</li>
<li><code>alk.phos</code>: fosfatasa alcalina (U/L)<br>
</li>
<li><code>ast</code>: transaminasa glutámico oxalacética (SGOT/AST)<br>
</li>
<li><code>trig</code>: triglicéridos (mg/dL)<br>
</li>
<li><code>platelet</code>: conteo de plaquetas (mil/mm³)<br>
</li>
<li><code>protime</code>: tiempo de protrombina (segundos)<br>
</li>
<li><code>stage</code>: estadio histológico de la enfermedad (1 a 4)</li>
</ul>
<p>Este conjunto permite modelar la supervivencia de pacientes hepáticos con múltiples variables clínicas y de laboratorio, y comparar dicha supervivencia con la de la población general mediante tablas de vida.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pbc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  id time status trt      age sex ascites hepato spiders edema bili chol
1  1  400      2   1 58.76523   f       1      1       1   1.0 14.5  261
2  2 4500      0   1 56.44627   f       0      1       1   0.0  1.1  302
3  3 1012      2   1 70.07255   m       0      0       0   0.5  1.4  176
4  4 1925      2   1 54.74059   f       0      1       1   0.5  1.8  244
5  5 1504      1   2 38.10541   f       0      1       1   0.0  3.4  279
6  6 2503      2   2 66.25873   f       0      1       0   0.0  0.8  248
  albumin copper alk.phos    ast trig platelet protime stage
1    2.60    156   1718.0 137.95  172      190    12.2     4
2    4.14     54   7394.8 113.52   88      221    10.6     3
3    3.48    210    516.0  96.10   55      151    12.0     4
4    2.54     64   6121.8  60.63   92      183    10.3     4
5    3.53    143    671.0 113.15   72      136    10.9     3
6    3.98     50    944.0  93.00   63       NA    11.0     3</code></pre>
</div>
</div>
<section id="resultado" class="level4">
<h4 class="anchored" data-anchor-id="resultado">Resultado</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar librería y datos</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(pbc)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar las variables necesarias</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>pbc<span class="sc">$</span>age_years <span class="ot">&lt;-</span> pbc<span class="sc">$</span>age                 <span class="co"># edad ya viene en años</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>pbc<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="dv">1974</span>                         <span class="co"># año promedio de inicio del estudio</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>pbc<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(pbc<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"m"</span>, <span class="st">"male"</span>, <span class="st">"female"</span>))  <span class="co"># convertir a formato requerido</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar supervivencia esperada usando la tabla de vida de EE.UU.</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>fit_exp <span class="ot">&lt;-</span> <span class="fu">survexp</span>(<span class="fu">Surv</span>(time <span class="sc">/</span> <span class="fl">365.25</span>, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ratetable =</span> survexp.us,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> pbc,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">times =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">15</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>                   <span class="at">cohort =</span> <span class="cn">TRUE</span>)  <span class="co"># tiempos en años</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar resultados</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>fit_exp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survexp(formula = Surv(time/365.25, status == 2) ~ 1, data = pbc, 
    times = seq(0, 15, by = 1), cohort = TRUE, ratetable = survexp.us)

 age ranges from 0.1 to 0.2 years
    male: 44  female: 374 
    date of entry from 1975-05-29 to 1975-05-29 

 time n.risk survival
    0    418    1.000
    1    389    1.000
    2    366    1.000
    3    313    1.000
    4    246    1.000
    5    198    1.000
    6    160    1.000
    7    115    1.000
    8     81    1.000
    9     57    1.000
   10     36    1.000
   11     25    1.000
   12      9    1.000
   13      1    0.999
   14      0    0.000
   15      0    0.000</code></pre>
</div>
</div>
</section>
</section>
<section id="comparación-con-curva-kaplan-meier" class="level3">
<h3 class="anchored" data-anchor-id="comparación-con-curva-kaplan-meier">Comparación con curva Kaplan-Meier</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar curva KM observada</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>fit_km <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time <span class="sc">/</span> <span class="fl">365.25</span>, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> pbc)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficar ambas curvas</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit_km, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">xlab =</span> <span class="st">"Años"</span>, <span class="at">ylab =</span> <span class="st">"Supervivencia"</span>, <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Supervivencia Observada vs Esperada"</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fit_exp<span class="sc">$</span>time, fit_exp<span class="sc">$</span>surv, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Kaplan-Meier (observada)"</span>, <span class="st">"Esperada (EE.UU.)"</span>),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_survival_revisado_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Este análisis compara la supervivencia observada en el estudio <code>pbc</code> con la supervivencia esperada de la población general de EE.UU., emparejada por edad, sexo y año de inicio.</p>
</section>
</section>
<section id="la-función-survdiff" class="level2">
<h2 class="anchored" data-anchor-id="la-función-survdiff">4. La función <code>survdiff()</code></h2>
<p>Permite realizar pruebas de comparación entre curvas de supervivencia de distintos grupos mediante pruebas de rango, como la prueba log-rank o sus extensiones ponderadas (<span class="citation" data-cites="harrington1982">Harrington &amp; Fleming (<a href="#ref-harrington1982" role="doc-biblioref">1982</a>)</span>).</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(formula, data, subset, weights, na.action, <span class="at">rho =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>formula</code>: fórmula del tipo <code>Surv(tiempo, estado) ~ grupo</code>, donde el grupo define la variable categórica a comparar.<br>
</li>
<li><code>rho</code>: parámetro de ponderación; <code>rho = 0</code> da la prueba log-rank estándar; valores positivos asignan más peso a eventos tardíos.<br>
</li>
<li><code>data</code>: conjunto de datos donde se encuentran las variables.<br>
</li>
<li><code>weights</code>: pesos opcionales para cada observación.</li>
</ul>
<section id="ejemplo-2" class="level3">
<h3 class="anchored" data-anchor-id="ejemplo-2">Ejemplo</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Datos del ejemplo: lung">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Datos del ejemplo: lung
</div>
</div>
<div class="callout-body-container callout-body">
<p>El conjunto de datos <code>lung</code> proviene del <em>North Central Cancer Treatment Group</em> y contiene información sobre la supervivencia de pacientes con cáncer de pulmón. El dataset incluye 228 registros con las siguientes variables principales:</p>
<ul>
<li><code>time</code>: tiempo de observación (en días)<br>
</li>
<li><code>status</code>: estado del paciente al final del estudio (1 = censurado, 2 = fallecido)<br>
</li>
<li><code>sex</code>: sexo del paciente (1 = hombre, 2 = mujer)<br>
</li>
<li><code>age</code>: edad en años<br>
</li>
<li><code>ph.ecog</code>, <code>ph.karno</code>, <code>pat.karno</code>: medidas del estado funcional<br>
</li>
<li><code>meal.cal</code>, <code>wt.loss</code>: calorías ingeridas y pérdida de peso reciente</li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lung)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  inst time status age sex ph.ecog ph.karno pat.karno meal.cal wt.loss
1    3  306      2  74   1       1       90       100     1175      NA
2    3  455      2  68   1       0       90        90     1225      15
3    3 1010      1  56   1       0       90        90       NA      15
4    5  210      2  57   1       1       90        60     1150      11
5    1  883      2  60   1       0      100        90       NA       0
6   12 1022      1  74   1       1       50        80      513       0</code></pre>
</div>
</div>
</section>
<section id="comparación-de-supervivencia-entre-sexos" class="level3">
<h3 class="anchored" data-anchor-id="comparación-de-supervivencia-entre-sexos">Comparación de supervivencia entre sexos</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cancer, <span class="at">package =</span> <span class="st">"survival"</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparar curvas por sexo con prueba log-rank (rho = 0)</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> sex, <span class="at">data =</span> lung)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(time, status == 2) ~ sex, data = lung)

        N Observed Expected (O-E)^2/E (O-E)^2/V
sex=1 138      112     91.6      4.55      10.3
sex=2  90       53     73.4      5.68      10.3

 Chisq= 10.3  on 1 degrees of freedom, p= 0.001 </code></pre>
</div>
</div>
</section>
<section id="comparación-con-ponderación-de-fleming-harrington-rho-1" class="level3">
<h3 class="anchored" data-anchor-id="comparación-con-ponderación-de-fleming-harrington-rho-1">Comparación con ponderación de Fleming-Harrington (rho = 1)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prueba log-rank ponderada, con más peso a diferencias en tiempos tardíos</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> sex, <span class="at">data =</span> lung, <span class="at">rho =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
survdiff(formula = Surv(time, status == 2) ~ sex, data = lung, 
    rho = 1)

        N Observed Expected (O-E)^2/E (O-E)^2/V
sex=1 138     70.4     55.6      3.95      12.7
sex=2  90     28.7     43.5      5.04      12.7

 Chisq= 12.7  on 1 degrees of freedom, p= 4e-04 </code></pre>
</div>
</div>
</section>
<section id="visualización-con-curvas-kaplanmeier" class="level3">
<h3 class="anchored" data-anchor-id="visualización-con-curvas-kaplanmeier">Visualización con curvas Kaplan–Meier</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fit_km <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> sex, <span class="at">data =</span> lung)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit_km, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Días"</span>, <span class="at">ylab =</span> <span class="st">"Supervivencia"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Supervivencia por sexo"</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Hombres"</span>, <span class="st">"Mujeres"</span>),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_survival_revisado_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="la-función-survreg" class="level2">
<h2 class="anchored" data-anchor-id="la-función-survreg">5. La función <code>survreg()</code></h2>
<p>La función <code>survreg()</code> permite ajustar <strong>modelos paramétricos de supervivencia</strong>. A diferencia del modelo de Cox, que es semiparamétrico, aquí se especifica la distribución del tiempo de supervivencia. Es útil cuando se desea una interpretación explícita del efecto temporal o cuando la función de riesgo se ajusta bien a una distribución conocida (Weibull, exponencial, log-normal, etc.).</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survreg</span>(formula, data, subset, weights, na.action, <span class="at">dist =</span> <span class="st">"weibull"</span>, <span class="at">scale =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>formula</code>: especifica la relación entre la variable de supervivencia y las covariables.</li>
<li><code>data</code>: conjunto de datos que contiene las variables.</li>
<li><code>dist</code>: distribución paramétrica a utilizar. Puede ser <code>"weibull"</code>, <code>"exponential"</code>, <code>"lognormal"</code>, <code>"loglogistic"</code>, <code>"gaussian"</code>, entre otras.</li>
<li><code>scale</code>: parámetro de escala (opcional).</li>
<li><code>weights</code>, <code>subset</code>, <code>na.action</code>: argumentos estándar para manejo de subconjuntos, pesos o valores faltantes.</li>
</ul>
<section id="ejemplo-3" class="level3">
<h3 class="anchored" data-anchor-id="ejemplo-3">Ejemplo</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Datos del ejemplo: lung">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Datos del ejemplo: lung
</div>
</div>
<div class="callout-body-container callout-body">
<p>El conjunto <code>lung</code> contiene información sobre pacientes con cáncer de pulmón. Las variables relevantes para este modelo incluyen:</p>
<ul>
<li><code>time</code>: tiempo hasta el evento (en días)<br>
</li>
<li><code>status</code>: indicador del evento (1 = censurado, 2 = fallecido)<br>
</li>
<li><code>age</code>: edad del paciente<br>
</li>
<li><code>sex</code>: sexo (1 = hombre, 2 = mujer)</li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajuste de modelo exponencial</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>fit_exp <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(time, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> lung, <span class="at">dist =</span> <span class="st">"exponential"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
survreg(formula = Surv(time, status == 2) ~ age + sex, data = lung, 
    dist = "exponential")
               Value Std. Error     z      p
(Intercept)  6.35967    0.63547 10.01 &lt;2e-16
age         -0.01562    0.00911 -1.72  0.086
sex          0.48093    0.16709  2.88  0.004

Scale fixed at 1 

Exponential distribution
Loglik(model)= -1156.1   Loglik(intercept only)= -1162.3
    Chisq= 12.48 on 2 degrees of freedom, p= 0.002 
Number of Newton-Raphson Iterations: 4 
n= 228 </code></pre>
</div>
</div>
</section>
<section id="cambio-de-distribución" class="level3">
<h3 class="anchored" data-anchor-id="cambio-de-distribución">Cambio de distribución</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajuste con distribución log-normal</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>fit_ln <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(time, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> lung, <span class="at">dist =</span> <span class="st">"lognormal"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_ln)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
survreg(formula = Surv(time, status == 2) ~ age + sex, data = lung, 
    dist = "lognormal")
               Value Std. Error     z       p
(Intercept)  6.40799    0.59293 10.81 &lt; 2e-16
age         -0.02336    0.00839 -2.78 0.00536
sex          0.51925    0.15515  3.35 0.00082
Log(scale)   0.05134    0.05602  0.92 0.35943

Scale= 1.05 

Log Normal distribution
Loglik(model)= -1158.8   Loglik(intercept only)= -1169.3
    Chisq= 21.04 on 2 degrees of freedom, p= 2.7e-05 
Number of Newton-Raphson Iterations: 3 
n= 228 </code></pre>
</div>
</div>
</section>
<section id="comparación-por-aic" class="level3">
<h3 class="anchored" data-anchor-id="comparación-por-aic">Comparación por AIC</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(fit_exp, fit_ln)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        df      AIC
fit_exp  3 2318.198
fit_ln   4 2325.500</code></pre>
</div>
</div>
<p>Esto permite determinar cuál modelo se ajusta mejor a los datos.</p>
</section>
<section id="interpretación" class="level3">
<h3 class="anchored" data-anchor-id="interpretación">Interpretación</h3>
<p>Los coeficientes estimados en <code>survreg()</code> se interpretan en el marco de una regresión acelerada del tiempo de falla (<strong>Accelerated Failure Time Model</strong>), es decir, una multiplicación del tiempo esperado de supervivencia por un factor exponencial del predictor.</p>
<p>Para una discusión detallada sobre modelos paramétricos de supervivencia, consulta <span class="citation" data-cites="klein2003">Klein &amp; Moeschberger (<a href="#ref-klein2003" role="doc-biblioref">2003</a>)</span> y <span class="citation" data-cites="therneau2000">Therneau &amp; Grambsch (<a href="#ref-therneau2000" role="doc-biblioref">2000</a>)</span>.</p>
</section>
</section>
<section id="la-función-coxph" class="level2">
<h2 class="anchored" data-anchor-id="la-función-coxph">6. La función <code>coxph()</code></h2>
<p>La función <code>coxph()</code> ajusta el modelo de regresión de Cox (modelo de riesgos proporcionales), ampliamente utilizado en análisis de supervivencia. Para una explicación computacional detallada, véase <span class="citation" data-cites="moore2016">Moore (<a href="#ref-moore2016" role="doc-biblioref">2016</a>)</span>, capítulo 4. Es un modelo <strong>semiparamétrico</strong>, ya que no especifica la forma funcional de la línea base de la función de riesgo, pero estima los efectos relativos de las covariables.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(formula, data, weights, subset, na.action, <span class="at">ties =</span> <span class="st">"efron"</span>, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>formula</code>: especifica la relación entre <code>Surv(tiempo, evento)</code> y las covariables.</li>
<li><code>data</code>: marco de datos con las variables.</li>
<li><code>ties</code>: método para manejar empates (opciones comunes: <code>"efron"</code> [por defecto], <code>"breslow"</code>, <code>"exact"</code>).</li>
<li><code>weights</code>, <code>subset</code>, <code>na.action</code>: argumentos estándar para subconjuntos, pesos y manejo de datos faltantes.</li>
</ul>
<section id="ejemplo-4" class="level3">
<h3 class="anchored" data-anchor-id="ejemplo-4">Ejemplo</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Datos del ejemplo: lung">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Datos del ejemplo: lung
</div>
</div>
<div class="callout-body-container callout-body">
<p>El dataset <code>lung</code> contiene datos sobre pacientes con cáncer de pulmón. Entre las variables relevantes:</p>
<ul>
<li><code>time</code>: tiempo de observación (días)<br>
</li>
<li><code>status</code>: 1 = censurado, 2 = fallecido<br>
</li>
<li><code>age</code>: edad del paciente<br>
</li>
<li><code>sex</code>: 1 = hombre, 2 = mujer</li>
</ul>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar un modelo de Cox</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fit_cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> lung)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_cox)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(time, status == 2) ~ age + sex, data = lung)

  n= 228, number of events= 165 

         coef exp(coef)  se(coef)      z Pr(&gt;|z|)   
age  0.017045  1.017191  0.009223  1.848  0.06459 . 
sex -0.513219  0.598566  0.167458 -3.065  0.00218 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

    exp(coef) exp(-coef) lower .95 upper .95
age    1.0172     0.9831    0.9990    1.0357
sex    0.5986     1.6707    0.4311    0.8311

Concordance= 0.603  (se = 0.025 )
Likelihood ratio test= 14.12  on 2 df,   p=9e-04
Wald test            = 13.47  on 2 df,   p=0.001
Score (logrank) test = 13.72  on 2 df,   p=0.001</code></pre>
</div>
</div>
</section>
<section id="interpretación-1" class="level3">
<h3 class="anchored" data-anchor-id="interpretación-1">Interpretación</h3>
<p>En este modelo, los coeficientes estimados representan el <strong>logaritmo del hazard ratio</strong>. Un hazard ratio mayor que 1 indica mayor riesgo del evento asociado a esa covariable, mientras que uno menor que 1 indica menor riesgo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(fit_cox))        <span class="co"># hazard ratios</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     age      sex 
1.017191 0.598566 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit_cox)          <span class="co"># intervalos de confianza</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           2.5 %      97.5 %
age -0.001031952  0.03512262
sex -0.841430092 -0.18500694</code></pre>
</div>
</div>
</section>
<section id="evaluación-de-ajuste" class="level3">
<h3 class="anchored" data-anchor-id="evaluación-de-ajuste">Evaluación de ajuste</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluar bondad de ajuste</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zph</span>(fit_cox)          <span class="co"># prueba de proporcionalidad</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       chisq df    p
age    0.209  1 0.65
sex    2.608  1 0.11
GLOBAL 2.771  2 0.25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">survfit</span>(fit_cox), <span class="at">xlab =</span> <span class="st">"Días"</span>, <span class="at">ylab =</span> <span class="st">"Supervivencia"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_survival_revisado_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>El modelo de regresión de Cox fue introducido por Cox (1972) y es ampliamente tratado en <span class="citation" data-cites="therneau2000">Therneau &amp; Grambsch (<a href="#ref-therneau2000" role="doc-biblioref">2000</a>)</span> y <span class="citation" data-cites="klein2003">Klein &amp; Moeschberger (<a href="#ref-klein2003" role="doc-biblioref">2003</a>)</span>.</p>
</section>
</section>
<section id="la-función-survfit.coxph" class="level2">
<h2 class="anchored" data-anchor-id="la-función-survfit.coxph">7. La función <code>survfit.coxph()</code></h2>
<p>Una vez ajustado un modelo de Cox con <code>coxph()</code>, es posible estimar curvas de supervivencia <strong>ajustadas</strong> para valores específicos de las covariables mediante <code>survfit()</code> aplicado al modelo ajustado. Esto permite visualizar la supervivencia predicha para diferentes perfiles de paciente.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survfit</span>(object, newdata, <span class="at">se.fit =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>object</code>: objeto resultante de <code>coxph()</code>.</li>
<li><code>newdata</code>: marco de datos que especifica los valores de las covariables para los cuales se desea predecir la supervivencia.</li>
<li><code>se.fit</code>: si se deben calcular los errores estándar.</li>
<li><code>conf.int</code>: nivel de confianza para los intervalos.</li>
</ul>
<section id="ejemplo-5" class="level3">
<h3 class="anchored" data-anchor-id="ejemplo-5">Ejemplo</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelo de Cox</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>fit_cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> lung)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar curva de supervivencia para un perfil específico</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>nuevo_paciente <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> <span class="dv">60</span>, <span class="at">sex =</span> <span class="dv">1</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>fit_surv <span class="ot">&lt;-</span> <span class="fu">survfit</span>(fit_cox, <span class="at">newdata =</span> nuevo_paciente)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficar la curva de supervivencia estimada</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit_surv, <span class="at">xlab =</span> <span class="st">"Días"</span>, <span class="at">ylab =</span> <span class="st">"Supervivencia estimada"</span>,</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Curva de supervivencia estimada para paciente masculino de 60 años"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_survival_revisado_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="tabla-de-supervivencia-estimada" class="level3">
<h3 class="anchored" data-anchor-id="tabla-de-supervivencia-estimada">Tabla de supervivencia estimada</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar una tabla resumen con tiempo y supervivencia estimada</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data.frame</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tiempo =</span> fit_surv<span class="sc">$</span>time,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Supervivencia =</span> <span class="fu">round</span>(fit_surv<span class="sc">$</span>surv, <span class="dv">4</span>),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Límite inferior</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(fit_surv<span class="sc">$</span>lower, <span class="dv">4</span>),</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Límite superior</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(fit_surv<span class="sc">$</span>upper, <span class="dv">4</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>), <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Tiempo Supervivencia Límite.inferior Límite.superior
1       5        0.9951          0.9855          1.0000
2      11        0.9804          0.9614          0.9997
3      12        0.9755          0.9543          0.9971
4      13        0.9656          0.9406          0.9913
5      15        0.9607          0.9339          0.9882
6      26        0.9557          0.9274          0.9849
7      30        0.9508          0.9210          0.9815
8      31        0.9458          0.9146          0.9781
9      53        0.9359          0.9020          0.9710
10     54        0.9309          0.8958          0.9674</code></pre>
</div>
</div>
</section>
<section id="comparación-entre-perfiles" class="level3">
<h3 class="anchored" data-anchor-id="comparación-entre-perfiles">Comparación entre perfiles</h3>
<p>También es posible comparar curvas para distintos perfiles:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>nuevo_pacientes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">60</span>, <span class="dv">60</span>),</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)  <span class="co"># hombre vs mujer</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>fit_comparado <span class="ot">&lt;-</span> <span class="fu">survfit</span>(fit_cox, <span class="at">newdata =</span> nuevo_pacientes)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit_comparado, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Días"</span>, <span class="at">ylab =</span> <span class="st">"Supervivencia"</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Supervivencia ajustada por sexo a edad 60"</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Hombre"</span>, <span class="st">"Mujer"</span>),</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_survival_revisado_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretación-2" class="level3">
<h3 class="anchored" data-anchor-id="interpretación-2">Interpretación</h3>
<p>Este tipo de predicción es útil para generar estimaciones personalizadas de supervivencia condicional, y es ampliamente utilizado en aplicaciones clínicas para comunicar pronósticos basados en modelos multivariados.</p>
<p>La interpretación y uso de curvas ajustadas en el modelo de Cox está discutida en <span class="citation" data-cites="therneau2000">Therneau &amp; Grambsch (<a href="#ref-therneau2000" role="doc-biblioref">2000</a>)</span>.</p>
</section>
</section>
<section id="la-función-basehaz" class="level2">
<h2 class="anchored" data-anchor-id="la-función-basehaz">8. La función <code>basehaz()</code></h2>
<p>La función <code>basehaz()</code> permite extraer la <strong>función de riesgo acumulado base</strong> (<em>baseline cumulative hazard</em>) a partir de un modelo de Cox ajustado con <code>coxph()</code>. Esta función es útil para visualizar cómo se acumula el riesgo a lo largo del tiempo en ausencia de covariables.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">basehaz</span>(fit, <span class="at">centered =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>fit</code>: modelo ajustado mediante <code>coxph()</code>.</li>
<li><code>centered</code>: si es <code>TRUE</code> (por defecto), el riesgo acumulado se estima para un individuo promedio (valores medios de las covariables). Si se establece en <code>FALSE</code>, el riesgo no se centra y refleja los valores brutos.</li>
</ul>
<section id="ejemplo-6" class="level3">
<h3 class="anchored" data-anchor-id="ejemplo-6">Ejemplo</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelo de Cox</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>fit_cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> lung)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer riesgo acumulado base</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>haz_base <span class="ot">&lt;-</span> <span class="fu">basehaz</span>(fit_cox, <span class="at">centered =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tabla-de-riesgo-acumulado" class="level3">
<h3 class="anchored" data-anchor-id="tabla-de-riesgo-acumulado">Tabla de riesgo acumulado</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar primeras filas como tabla</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data.frame</span>(</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tiempo =</span> haz_base<span class="sc">$</span>time,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Riesgo acumulado</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(haz_base<span class="sc">$</span>hazard, <span class="dv">4</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>), <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Tiempo Riesgo.acumulado
1       5           0.0042
2      11           0.0169
3      12           0.0212
4      13           0.0298
5      15           0.0342
6      26           0.0386
7      30           0.0430
8      31           0.0474
9      53           0.0564
10     54           0.0609</code></pre>
</div>
</div>
</section>
<section id="visualización" class="level3">
<h3 class="anchored" data-anchor-id="visualización">Visualización</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficar función de riesgo acumulado base</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(haz_base<span class="sc">$</span>time, haz_base<span class="sc">$</span>hazard, <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Días"</span>, <span class="at">ylab =</span> <span class="st">"Riesgo acumulado"</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Función de riesgo acumulado base"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_survival_revisado_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretación-3" class="level3">
<h3 class="anchored" data-anchor-id="interpretación-3">Interpretación</h3>
<p>La función de riesgo acumulado es clave en el modelo de Cox, ya que permite reconstruir la función de supervivencia predicha cuando se combina con los efectos de las covariables. Una pendiente más pronunciada en la curva indica mayor ocurrencia de eventos en esa región del tiempo.</p>
<p>Una descripción técnica del cálculo e interpretación de la función de riesgo acumulado puede encontrarse en <span class="citation" data-cites="therneau2000">Therneau &amp; Grambsch (<a href="#ref-therneau2000" role="doc-biblioref">2000</a>)</span>.</p>
</section>
</section>
<section id="la-función-residuals.coxph" class="level2">
<h2 class="anchored" data-anchor-id="la-función-residuals.coxph">9. La función <code>residuals.coxph()</code></h2>
<p>La función <code>residuals.coxph()</code> permite obtener diferentes tipos de <strong>residuos</strong> a partir de un modelo de Cox ajustado con <code>coxph()</code>. Estos residuos son útiles para diagnosticar el ajuste del modelo, detectar observaciones influyentes o evaluar supuestos.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(object, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"martingale"</span>, <span class="st">"deviance"</span>, <span class="st">"schoenfeld"</span>, <span class="st">"dfbeta"</span>, <span class="st">"score"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>object</code>: modelo ajustado mediante <code>coxph()</code>.</li>
<li><code>type</code>: tipo de residuo a calcular:
<ul>
<li><code>"martingale"</code>: para evaluar el ajuste del modelo</li>
<li><code>"deviance"</code>: transformación simétrica de los residuos de martingala</li>
<li><code>"schoenfeld"</code>: usados para evaluar el supuesto de riesgos proporcionales</li>
<li><code>"dfbeta"</code>: influencia de cada observación en los coeficientes</li>
<li><code>"score"</code>: residuo de score para cada observación</li>
</ul></li>
</ul>
<section id="ejemplo-7" class="level3">
<h3 class="anchored" data-anchor-id="ejemplo-7">Ejemplo</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelo de Cox</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>fit_cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> lung)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular residuos de martingala</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>res_mart <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit_cox, <span class="at">type =</span> <span class="st">"martingale"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tabla-de-residuos" class="level3">
<h3 class="anchored" data-anchor-id="tabla-de-residuos">Tabla de residuos</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar los primeros residuos de martingala</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data.frame</span>(</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res_mart),</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Residuo martingala</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(res_mart, <span class="dv">4</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>), <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ID Residuo.martingala
1   1             0.0044
2   2            -0.5058
3   3            -3.1298
4   4             0.5328
5   5            -2.3507
6   6            -4.2537
7   7             0.4475
8   8             0.2900
9   9             0.5483
10 10             0.6806</code></pre>
</div>
</div>
</section>
<section id="visualización-del-ajuste" class="level3">
<h3 class="anchored" data-anchor-id="visualización-del-ajuste">Visualización del ajuste</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Residuo martingala vs edad</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lung<span class="sc">$</span>age, res_mart, <span class="at">xlab =</span> <span class="st">"Edad"</span>, <span class="at">ylab =</span> <span class="st">"Residuo de martingala"</span>,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Diagnóstico de ajuste (edad vs residuo)"</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"gray"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_survival_revisado_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretación-4" class="level3">
<h3 class="anchored" data-anchor-id="interpretación-4">Interpretación</h3>
<ul>
<li>Residuos <strong>de martingala</strong> cercanos a 0 indican buen ajuste.</li>
<li>Valores extremos (positivos o negativos) pueden indicar <strong>mal ajuste o valores atípicos</strong>.</li>
<li>La relación de los residuos con covariables puede revelar <strong>no linealidades</strong> o <strong>necesidad de transformación</strong>.</li>
</ul>
<p>Para una explicación detallada de los residuos diagnósticos en modelos de Cox, consulta <span class="citation" data-cites="therneau2000">Therneau &amp; Grambsch (<a href="#ref-therneau2000" role="doc-biblioref">2000</a>)</span>.</p>
</section>
</section>
<section id="la-función-cox.zph" class="level2">
<h2 class="anchored" data-anchor-id="la-función-cox.zph">10. La función <code>cox.zph()</code></h2>
<p>La función <code>cox.zph()</code> permite evaluar el <strong>supuesto de riesgos proporcionales</strong> en el modelo de Cox. Este supuesto implica que el efecto de las covariables sobre la razón de riesgos es constante a lo largo del tiempo.</p>
<p>Este diagnóstico se basa en los <strong>residuos de Schoenfeld</strong>, y puede visualizarse gráficamente junto con una prueba estadística de correlación entre el tiempo y el residuo.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cox.zph</span>(fit, <span class="at">transform =</span> <span class="st">"rank"</span>, <span class="at">terms =</span> <span class="cn">TRUE</span>, <span class="at">global =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>fit</code>: modelo ajustado con <code>coxph()</code>.</li>
<li><code>transform</code>: tipo de transformación del tiempo para el test (por defecto <code>"rank"</code>).</li>
<li><code>terms</code>: si se debe aplicar el test individual a cada covariable.</li>
<li><code>global</code>: si se incluye una prueba conjunta para todo el modelo.</li>
</ul>
<section id="ejemplo-8" class="level3">
<h3 class="anchored" data-anchor-id="ejemplo-8">Ejemplo</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajustar modelo de Cox</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>fit_cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> age <span class="sc">+</span> sex, <span class="at">data =</span> lung)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluar el supuesto de riesgos proporcionales</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>zph_test <span class="ot">&lt;-</span> <span class="fu">cox.zph</span>(fit_cox)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>zph_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       chisq df    p
age    0.209  1 0.65
sex    2.608  1 0.11
GLOBAL 2.771  2 0.25</code></pre>
</div>
</div>
</section>
<section id="visualización-1" class="level3">
<h3 class="anchored" data-anchor-id="visualización-1">Visualización</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de residuos de Schoenfeld</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(zph_test, <span class="at">var =</span> <span class="st">"age"</span>, <span class="at">resid =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Tiempo transformado"</span>, <span class="at">ylab =</span> <span class="st">"Residuo de Schoenfeld"</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Evaluación de proporcionalidad para 'age'"</span>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_survival_revisado_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Otro ejemplo: para 'sex'</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(zph_test, <span class="at">var =</span> <span class="st">"sex"</span>, <span class="at">resid =</span> <span class="cn">TRUE</span>,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Evaluación de proporcionalidad para 'sex'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_survival_revisado_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretación-5" class="level3">
<h3 class="anchored" data-anchor-id="interpretación-5">Interpretación</h3>
<ul>
<li>Si la curva estimada es <strong>horizontal y cercana a cero</strong>, se cumple el supuesto.</li>
<li>Si hay una tendencia sistemática en el tiempo, el efecto <strong>no es proporcional</strong>.</li>
<li>El valor <code>p</code> asociado a cada covariable permite formalizar el test:
<ul>
<li><code>p &lt; 0.05</code> → evidencia contra el supuesto de proporcionalidad.</li>
<li><code>p &gt; 0.05</code> → no hay evidencia suficiente para rechazarlo.</li>
</ul></li>
</ul>
<p>El método de evaluación del supuesto de riesgos proporcionales mediante residuos de Schoenfeld se encuentra detallado en <span class="citation" data-cites="therneau2000">Therneau &amp; Grambsch (<a href="#ref-therneau2000" role="doc-biblioref">2000</a>)</span>.</p>
</section>
</section>
<section id="la-función-strata" class="level2">
<h2 class="anchored" data-anchor-id="la-función-strata">11. La función <code>strata()</code></h2>
<p>La función <code>strata()</code> se utiliza dentro de una fórmula de modelo en <code>coxph()</code> para indicar que una o más variables deben tratarse como <strong>estratos</strong>. Esto permite ajustar un modelo de Cox donde el efecto de ciertas variables <strong>no se modela directamente</strong>, sino que se <strong>permite que la función de riesgo base varíe por estrato</strong>.</p>
<p>Esto es especialmente útil cuando una covariable <strong>no cumple el supuesto de riesgos proporcionales</strong> pero se desea conservar su estructura en el modelo.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coxph</span>(<span class="fu">Surv</span>(tiempo, evento) <span class="sc">~</span> covariables <span class="sc">+</span> <span class="fu">strata</span>(estrato), <span class="at">data =</span> datos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>strata(...)</code>: se coloca dentro de la fórmula para indicar que las curvas de riesgo base deben estimarse por separado para cada nivel del estrato.</li>
</ul>
<section id="ejemplo-9" class="level3">
<h3 class="anchored" data-anchor-id="ejemplo-9">Ejemplo</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo con estratificación por institución</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>fit_strat <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> age <span class="sc">+</span> <span class="fu">strata</span>(inst), <span class="at">data =</span> lung)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_strat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(time, status == 2) ~ age + strata(inst), 
    data = lung)

  n= 227, number of events= 164 
   (1 observation deleted due to missingness)

        coef exp(coef) se(coef)     z Pr(&gt;|z|)  
age 0.021643  1.021879 0.009844 2.198   0.0279 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

    exp(coef) exp(-coef) lower .95 upper .95
age     1.022     0.9786     1.002     1.042

Concordance= 0.574  (se = 0.031 )
Likelihood ratio test= 4.99  on 1 df,   p=0.03
Wald test            = 4.83  on 1 df,   p=0.03
Score (logrank) test = 4.87  on 1 df,   p=0.03</code></pre>
</div>
</div>
<p>En este ejemplo, la variable <code>inst</code> representa diferentes instituciones médicas. Al usarla como estrato, se permite que cada institución tenga su propia curva de riesgo base, pero se estima un efecto común de la edad en todos los grupos.</p>
</section>
<section id="comparación-con-modelo-sin-estratificación" class="level3">
<h3 class="anchored" data-anchor-id="comparación-con-modelo-sin-estratificación">Comparación con modelo sin estratificación</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>fit_no_strat <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">~</span> age <span class="sc">+</span> inst, <span class="at">data =</span> lung)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Este segundo modelo estima un coeficiente para cada nivel de <code>inst</code>, asumiendo proporcionalidad, lo cual puede ser inadecuado si el supuesto no se cumple.</p>
</section>
<section id="visualización-2" class="level3">
<h3 class="anchored" data-anchor-id="visualización-2">Visualización</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">survfit</span>(fit_strat), <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Días"</span>, <span class="at">ylab =</span> <span class="st">"Supervivencia"</span>,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Curvas estratificadas por institución"</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>, <span class="at">legend =</span> <span class="fu">levels</span>(<span class="fu">factor</span>(lung<span class="sc">$</span>inst)), <span class="at">col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_survival_revisado_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretación-6" class="level3">
<h3 class="anchored" data-anchor-id="interpretación-6">Interpretación</h3>
<p>La estratificación permite controlar por una variable que afecta la forma del riesgo base pero <strong>no interesa modelar directamente su efecto</strong>. Así, se mejora la validez del modelo para otras covariables de interés.</p>
<p>El uso de estratos en modelos de Cox está ampliamente discutido en <span class="citation" data-cites="therneau2000">Therneau &amp; Grambsch (<a href="#ref-therneau2000" role="doc-biblioref">2000</a>)</span> y es una herramienta clave para relajar el supuesto de riesgos proporcionales.</p>
</section>
</section>
<section id="referencias" class="level2">
<h2 class="anchored" data-anchor-id="referencias">Referencias</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-harrington1982" class="csl-entry" role="listitem">
Harrington, D. P., &amp; Fleming, T. R. (1982). A class of rank test procedures for censored survival data. <em>Biometrika</em>, <em>69</em>(3), 553–566. <a href="https://doi.org/10.1093/biomet/69.3.553">https://doi.org/10.1093/biomet/69.3.553</a>
</div>
<div id="ref-klein2003" class="csl-entry" role="listitem">
Klein, J. P., &amp; Moeschberger, M. L. (2003). <em>Survival analysis: Techniques for censored and truncated data</em> (2nd ed.). Springer.
</div>
<div id="ref-moore2016" class="csl-entry" role="listitem">
Moore, D. F. (2016). <em>Applied survival analysis using r</em> (2nd ed.). Springer. <a href="https://doi.org/10.1007/978-3-319-31245-3">https://doi.org/10.1007/978-3-319-31245-3</a>
</div>
<div id="ref-therneau2000" class="csl-entry" role="listitem">
Therneau, T. M., &amp; Grambsch, P. M. (2000). <em>Modeling survival data: Extending the cox model</em>. Springer.
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="R_survival_revisado_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>